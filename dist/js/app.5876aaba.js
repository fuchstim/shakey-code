(function(e){function t(t){for(var r,s,o=t[0],c=t[1],l=t[2],u=0,d=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&d.push(a[s][0]),a[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);h&&h(t);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(r=!1)}r&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},a={app:0},i=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var h=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"07d4":function(e,t,n){"use strict";function r(e,t){const n={};e.scan(0,0,e.bitmap.width,e.bitmap.height,(r,a)=>{const i=e.getPixelColour(r,a),{colour:s}=t.findClosestBitColour(i),o=t.calculateColourDistance(i,s);o<2e4&&(n[s]=(n[s]||0)+1)});const r=Object.entries(n).sort(([,e],[,t])=>e-t).pop();return r&&Number(r[0])}function a(e,t){const n=e.clone();return n.scan(0,0,n.bitmap.width,n.bitmap.height,(e,r)=>{const a=n.getPixelColour(e,r),{colour:i}=t.findClosestBitColour(a),s=t.calculateColourDistance(a,i);s>2e4?n.setPixelColour(0,e,r):n.setPixelColour(i,e,r)}),n}t["a"]={filterPrimaryBitColour:r,filterBitColours:a}},"0ac7":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAAXNSR0IArs4c6QAAAfxJREFUSEutlr1OwzAQx89EIF4ChiKEusHUiGfo2DIi3oGBATFFDAy8A3NbmMoroHYCFmiF6FB4iUokRuf4krPzYafqLW0S+3735X8ioIm1OhIWU+HcUrLOvYm84uabCUAUQgbDe2QUQNk6AGgEkt8TEA+QwtAQTMbuyQsAccACWgeEfhWsxjYC4hB0aIPj8wSCw9O8vDogv9JR3fUmAvCkMIAMbJVNBeOcIFzAQBxycnWvtr/eXapy4jO89zYamm4XU9EIRBACyCSB96fHfDCiEI57/RRkDYo3CCcOjSAUchLHsBUEKit6tj5Ilw9hHITOyXCcKRg12nz8o7BBj1jVsTyqL+QQoBqC+7xArY6U7X2jucH8F+Kvl8IcqazYWtEbZEqS9qhMSuxpG50ZjsXH0rjeEQJW7T11b3u2hD8SJy1Ngo9uJi3kgk+OLoGdHaftzn7U5UrKigPLMyLnqF38v/aIoKOxdU4AYN7tg/hcmgDya5wj6/Sr7EpE0xtkqXh+jvDB9QTgVo8mH09dNvzZDMjuDUk/a4QTVOajIEEe5asDZfGMB/mrRL8oixLEB6NwUtLSOc0LRF5sxe6a54jD1LTVWa16O0CGc48Plmr15v2KTGnB4MXz0E/5daZuEH312L3zyMIob2VpKz6bnINQsaA+I9zUMPKqQP4B3LkjinGnCIMAAAAASUVORK5CYIIA"},"0acb":function(e,t,n){"use strict";n("d6cc")},1:function(e,t){},1865:function(e,t,n){"use strict";n("b9ef")},"1be4":function(e,t,n){"use strict";n("b07e")},2:function(e,t){},"39c7":function(e,t,n){"use strict";(function(e){var r=n("ef21"),a=n.n(r),i=n("07d4"),s=n("3c62"),o=n("c45a");class c{constructor({drawDebug:e,onSampleRecorded:t,onResult:n,sampleCount:r}={}){this._drawDebug=e,this.onSampleRecorded=t||(()=>{}),this.onResult=n||(()=>{}),this.sampleCount=r||3,this.tailPattern=new s["a"]({drawDebug:e=>this.drawDebug(e),pattern:[[{length:3,value:1},{length:2,value:0},{length:1,value:1},{length:2,value:0},{length:3,value:1}],[{length:1,value:0},{length:1,value:1},{length:3,value:0},{length:1,value:1},{length:3,value:0},{length:2,value:1}],[{length:1,value:0},{length:1,value:1},{length:1,value:0},{length:3,value:1},{length:3,value:0},{length:2,value:1}],[{length:1,value:0},{length:3,value:1},{length:2,value:0},{length:5,value:1}],[{length:2,value:0},{length:1,value:1},{length:3,value:0},{length:1,value:1},{length:3,value:0},{length:1,value:1}]]}),this.colourEncoder=new o["a"].ColourEncoder,this.samples=[]}async decode(t){if(!t.length)return;const n=await a.a.read(e.from(t,"base64")),r=this._findTailPattern(n);if(!r)return;const i=this._cropCode(n,r),s=this._parseCode(i);if(this._recordSample(s),this.samples.length>=this.sampleCount)try{const e=this.colourEncoder.decode(this.samples[0]);this.onResult.apply(this.onResult,[e])}catch(o){this.samples=[],console.error(o)}}_findTailPattern(e){const t=this.tailPattern.findCandidates(e);return t[0]}_cropCode(e,t){const n=7/11,r=1.4,a={x:t.x+t.width,y:t.y-(t.height*r-t.height)/2,width:Math.ceil(t.width*n),height:Math.ceil(t.height*r)},i=e.clone().crop(a.x,a.y,a.width,a.height);return i}_parseCode(e){const t=7,n=Math.round(e.bitmap.height/t),r=Math.round(e.bitmap.width/t),a=[];for(let s=1;s<t-1;s++){const o=s*r;for(let s=1;s<t-1;s++){const t=s*r,c=i["a"].filterPrimaryBitColour(e.clone().crop(t,o,r,n),this.colourEncoder);a.push(c)}}return a}_recordSample(e){this._compareSample(this.samples[0],e)?this.samples.push(e):this.samples=[e],this.onSampleRecorded.apply(this.onSampleRecorded,[{bits:e,samples:this.samples,sampleProgress:Math.min(Math.round(100*this.samples.length/this.sampleCount),100)}])}_compareSample(e,t){return!(!e||!t)&&e.every((e,n)=>e===t[n])}async drawDebug(e){await Object.entries(e).reduce(async(e,[t,n])=>{await e,this._drawDebug(t,{width:n.bitmap.width,height:n.bitmap.height,data:await n.getBase64Async("image/png")})},Promise.resolve())}}t["a"]=c}).call(this,n("b639").Buffer)},"3c62":function(e,t,n){"use strict";var r=n("ef21"),a=n.n(r);const i=a.a.rgbaToInt(0,0,0,255),s=a.a.rgbaToInt(255,255,255,255);class o{constructor(e){this.pattern=e.pattern,this.lightDarkCutoff=e.lightDarkCutoff||a.a.rgbaToInt(10,10,10,255),this.drawDebug=e.drawDebug,this.accuracy=e.accuracy||.5,this.patternMatchThreshold=e.patternMatchThreshold||this.accuracy,this.minSegmentLength=e.minSegmentLength||5}findCandidates(e){const t=this._findOutlines(e),n=this._getLineSequences(t),r=this._findCandidatesWithLineSequences(n),a=r.map(e=>({...e,matchScore:this._calculateCandidateMatchScore(t,e)})),i=a.filter(({matchScore:e})=>e>=this.patternMatchThreshold).sort((e,t)=>t-e);return i}_findOutlines(e){const t=e.clone();return t.greyscale().contrast(.1).scan(0,0,t.bitmap.width,t.bitmap.height,(e,n)=>{t.getPixelColour(e,n)>=this.lightDarkCutoff?t.setPixelColour(s,e,n):t.setPixelColour(i,e,n)}),t}_getLineSequences(e){const t=[];for(let r=1;r<=e.bitmap.height;r++){t[r]=[];let n={x:0,y:r,value:e.getPixelColour(1,r)===i?1:0,length:0};for(let a=1;a<=e.bitmap.width;a++){const s=e.getPixelColour(a,r)===i?1:0;n.value===s?n.length++:(n.length>=this.minSegmentLength&&t[r].push(n),n={x:a,y:r,value:s,length:1})}n.length>=this.minSegmentLength&&t[r].push(n)}const n=this._deduplicateSequences(t);return n.map(e=>this._calculateRelativeSegmentLengths(e))}_findCandidatesWithLineSequences(e){const t=[];return e.forEach(e=>{e.forEach((n,r)=>{const a=t.some(({x:e,y:t,width:r,height:a})=>{const i=n.x>=e&&n.x<=e+r,s=n.y>=t&&n.y<=t+a;return i&&s});if(a)return;const i=this.pattern[0],s=e.slice(r,r+i.length),o=this._compareSequences(i,s);if(!o)return;const c=i.reduce((e,{length:t})=>e+t,0),l=s.reduce((e,{length:t})=>e+t,0),h=Math.round(l/c),u=this.pattern.length*h;t.push({x:n.x,y:n.y,scale:h,width:l,height:u})})}),t}_calculateRelativeSegmentLengths(e){const t=e.map(({length:e})=>Number(e)).sort((e,t)=>e-t),n=t[0],r=t.filter(e=>e>=n*this.accuracy&&e<=n*(2-this.accuracy)),a=r.reduce((e,t)=>e+t,0)/r.length,i=e.map(e=>({...e,relativeLength:e.length/a}));return i}_trimSequence(e){return e.slice(0===e[0].value?1:0,0===e[e.length-1].value?e.length-1:e.length)}_compareSequences(e,t){const n=this._trimSequence(e).map(({value:e})=>e),r=this._trimSequence(t).map(({value:e})=>e);if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==r[s])return!1;const a=this._calculateRelativeSegmentLengths(e).map(({relativeLength:e})=>e),i=this._calculateRelativeSegmentLengths(t).map(({relativeLength:e})=>e);for(let s=0;s<a.length;s++){const e=a[s],t=i[s];if(e<t*this.accuracy||e>t*(2-this.accuracy))return!1}return!0}_deduplicateSequences(e){const t=[],n=e.reduce((e,n)=>{if(!e.length)return t.push(0),[n];const r=this._compareSequences(n,e[e.length-1]);return r?t[t.length-1]+=1:(t[t.length-1]<1&&(e.pop(),t.pop()),t.push(0),e.push(n)),e},[]);return n}_calculateCandidateMatchScore(e,t){const n=e.clone().crop(t.x,t.y,t.width,t.height),r=this._getLineSequences(n),a=this.pattern,i=Math.min(r.length,a.length),s=Array(i).fill().map((e,t)=>{const n=r[t],i=a[t],s=this._compareSequences(n,i);return{candidateLineSequence:n,patternLineSequence:i,match:s}}),o=Math.round(100*s.filter(({match:e})=>e).length/s.length)/100;return o}}t["a"]=o},"56d7":function(e,t,n){"use strict";n.r(t);var r=n("2b0e"),a=n("8c4f"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h1",{staticClass:"title"},[e._v(" Encode ")]),n("p",{staticClass:"label"},[e._v(" Input code here: ")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.input,expression:"input"}],attrs:{type:"text"},domProps:{value:e.input},on:{input:function(t){t.target.composing||(e.input=t.target.value)}}}),e.error?n("p",{attrs:{id:"error"}},[e._v(" "+e._s(e.error)+" ")]):e._e(),e.result?n("img",{attrs:{src:e.result}}):e._e()])},s=[],o=n("8aed"),c={name:"Encoder",data:()=>({input:void 0,error:null,result:null,encoder:new o["a"]}),watch:{input(e){return this.encoder.encode(e).then(e=>{this.error=null,this.result=e}).catch(e=>{this.error=e.message,this.result=null})}},mounted(){this.input=""}},l=c,h=(n("0acb"),n("2877")),u=Object(h["a"])(l,i,s,!1,null,"0b332464",null),d=u.exports,g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h1",{staticClass:"title"},[e._v(" Decode ")]),n("button",{on:{click:e.detectCode}},[e._v(" Run ")]),n("p",{staticClass:"label"},[e._v(" Scanning... "+e._s(e.progress||0)+"% ")]),e.result?n("p",{staticClass:"result"},[e._v(" "+e._s(e.result)+" ")]):e._e(),e.error?n("p",{staticClass:"error"},[e._v(" "+e._s(e.error)+" ")]):e._e(),n("div",{staticClass:"preview"},[n("div",{ref:"viewfinder",staticClass:"viewfinder"}),n("video",{ref:"preview",attrs:{autoplay:"",playsinline:""}})]),n("div",{staticClass:"canvases"},[n("canvas",{ref:"focus",staticClass:"focus"}),n("div",{ref:"debugViews",staticClass:"debugViews"})])])},p=[],f=n("39c7"),m={name:"Decoder",data:()=>({stream:null,isScanning:!1,fps:5,scanInterval:null,result:"",error:"",progress:0,debugViews:{},decoder:new f["a"]}),async mounted(){try{this.stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"}}}),this.decoder._drawDebug=(e,t)=>this.drawDebug(e,t),this.decoder.onResult=e=>this.result=e,this.decoder.onSampleRecorded=({sampleProgress:e})=>this.progress=e,this.startScan()}catch(e){this.stopScan(),this.error=e.message}},beforeDestroy(){this.stopScan()},methods:{startScan(){try{const e=this.$refs.preview;e.srcObject=this.stream,this.scanInterval&&clearInterval(this.scanInterval),this.scanInterval=setInterval(()=>this.detectCode(),1e3/this.fps),this.isScanning=!0}catch(e){this.error=e.message}},stopScan(){this.scanInterval&&clearInterval(this.scanInterval),this.stream.getTracks().forEach(e=>e.stop()),this.isScanning=!1},async detectCode(){const e=this.$refs.preview,t=this.$refs.focus,n=this.computeScanArea({width:e.videoWidth,height:e.videoHeight});this.updateViewfinder(n),t.width=n.width,t.height=n.height,t.getContext("2d").clearRect(0,0,n.width,n.height),t.getContext("2d").drawImage(e,n.x,n.y,n.width,n.height,0,0,t.width,t.height);try{await this.decoder.decode(t.toDataURL().split(",")[1])}catch(r){throw this.error=r.message,r}},computeScanArea({width:e,height:t}){const n=Math.max(e,t)/2,r=e===n?0:(e-n)/2,a=t===n?0:(t-n)/2,i=n/e,s=n/t;return{width:n,height:n,relativeWidth:i,relativeHeight:s,x:r,y:a}},updateViewfinder({relativeWidth:e,relativeHeight:t}){const n=this.$refs.viewfinder,r=this.$refs.preview,a=r.offsetHeight*t,i=r.offsetWidth*e;n.style.width=i+"px",n.style.height=a+"px"},drawDebug(e,t){let n;if(this.debugViews[e])n=this.debugViews[e].canvas;else{const t=document.createElement("div"),r=document.createElement("h4");r.innerText=e,n=document.createElement("canvas"),t.appendChild(r),t.appendChild(n),this.$refs.debugViews.appendChild(t),this.debugViews[e]={container:t,canvas:n}}n.width=160,n.height=160,n.getContext("2d").clearRect(0,0,n.width,n.height);let r=Math.min(n.width/t.width,n.height/t.height),a=(n.width-t.width*r)/2,i=(n.height-t.height*r)/2;var s=new Image;s.onload=function(){n.getContext("2d").drawImage(s,0,0,t.width,t.height,a,i,t.width*r,t.height*r)},s.src=t.data||t.toDataURL()}}},v=m,w=(n("1be4"),Object(h["a"])(v,g,p,!1,null,"13799ca0",null)),b=w.exports;r["a"].use(a["a"]);const C=[{path:"/",redirect:"/encode"},{path:"/encode",component:d},{path:"/decode",component:b}],y=new a["a"]({routes:C});var S=y,_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("navigation",{staticStyle:{"z-index":"1"}}),n("div",{staticClass:"container"},[n("router-view",{staticClass:"content"})],1)],1)},x=[],A=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},e._l(e.routes,(function(t){return n("div",{key:t.path,staticClass:"item",class:{active:e.$route.path===t.path}},[n("router-link",{attrs:{to:t.path}},[e._v(" "+e._s(t.title)+" ")])],1)})),0)},E=[],I={name:"Navigation",data:()=>({routes:[{path:"/encode",title:"Encode"},{path:"/decode",title:"Decode"}]})},M=I,O=(n("1865"),Object(h["a"])(M,A,E,!1,null,"e1e08802",null)),j=O.exports,D={name:"ShakeyDemo",components:{navigation:j},data:()=>({})},L=D,R=(n("034f"),Object(h["a"])(L,_,x,!1,null,null,null)),P=R.exports;r["a"].config.productionTip=!1,new r["a"]({router:S,render(e){return e(P)}}).$mount("#app")},"85ec":function(e,t,n){},"8aed":function(e,t,n){"use strict";(function(e){var r=n("ef21"),a=n.n(r),i=n("0ac7"),s=n.n(i),o=n("c45a");class c{constructor(){}async encode(t){const n=await a.a.read(e.from(s.a.split(",")[1],"base64")),{width:r,height:i}=n.bitmap,c=o["a"].image.getReplaceablePixels(n),l=new o["a"].ColourEncoder,h=l.encode(t,{length:c.length,includeParityBit:!0});h.forEach((e,t)=>{const{x:r,y:a}=c[t];n.setPixelColour(e,r,a)});const u=new a.a(1.4*r,1.4*i,a.a.rgbaToInt(255,255,255,255));u.composite(n,Math.floor(r/5),Math.floor(i/5));const d=await u.resize(512,512,a.a.RESIZE_NEAREST_NEIGHBOR).getBase64Async("image/png");return d}}t["a"]=c}).call(this,n("b639").Buffer)},b07e:function(e,t,n){},b9ef:function(e,t,n){},c45a:function(e,t,n){"use strict";function r(...e){console.log(e.join(" "))}function a(...e){r("[info]",...e)}function i(...e){r("[warn]",...e)}function s(...e){r("[error]",...e)}var o={info:a,warn:i,error:s},c=n("ef21"),l=n.n(c);const h=l.a.rgbaToInt(38,255,0,255);function u(e){const t=[];return e.scan(0,0,e.bitmap.width,e.bitmap.height,(n,r)=>{e.getPixelColour(n,r)===h&&t.push({x:n,y:r})}),t}var d={replaceableColour:h,getReplaceablePixels:u};const g={A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,J:10,K:11,L:12,M:13,N:14,O:15,P:16,Q:17,R:18,S:19,T:20,U:21,V:22,W:23,X:24,Y:25,Z:26,0:27,1:28,2:29,3:30,4:31,5:32,6:33,7:34,8:35,9:36},p={0:l.a.rgbaToInt(255,75,85,255),1:l.a.rgbaToInt(255,255,255,255),2:l.a.rgbaToInt(0,159,255,255)};class f{constructor(e={}){this.characterCodes=e.characterCodes||g,this.bitColours=e.bitColours||p}get charLength(){return Math.max(...Object.values(this.characterCodes).map(e=>e.toString(3).length))}encode(e,t={}){const{length:n}=t,r=e.split(""),a=r.map(e=>{const t=this.characterCodes[e];if(!t)throw new Error("Cannot resolve unknown character: "+e);return this._padCharacterCode(t.toString(3))}),i=a.join("").split(""),s=i.reduce((e,t)=>e+Number(t),0);if(i.push(String(s%3)),n>0&&i.length>n)throw new Error(`Encoded value has length ${i.length} which exceeds max length of ${n}`);const o=n>0&&n-i.length;if(o){const e=Array(o).fill("0");i.push(...e)}return i.map(e=>this.bitColours[e])}decode(e){const t=e.map(e=>this._findClosestBit(e)),n=Array(Math.ceil(t.length/this.charLength)).fill().map((e,n)=>t.slice(n*this.charLength,(n+1)*this.charLength)).filter(e=>!e.every(e=>"0"===e)),r=n.pop()[0],a=n.map(e=>e.reduce((e,t)=>e+Number(t),0)).reduce((e,t)=>e+Number(t),0);if(Number(r)!==a%3)throw new Error("Failed to decode invalid data");const i=n.map(e=>parseInt(e.join(""),3)),s=i.map(e=>{const[t]=Object.entries(this.characterCodes).find(([,t])=>t===e);if(!t)throw new Error("Failed to resolve character with code "+e);return t}).join("");return s}_padCharacterCode(e){const t=[...Array(this.charLength-e.length).fill("0"),e].join("");return t}findClosestBitColour(e){const[{bit:t,colour:n}]=Object.entries(this.bitColours).map(([t,n])=>{const r=this.calculateColourDistance(e,n);return{bit:t,colour:n,distance:r}}).sort(({distance:e},{distance:t})=>e-t);return{bit:t,colour:n}}calculateColourDistance(e,t){const n=l.a.intToRGBA(e),r=l.a.intToRGBA(t);return Math.pow(r.r-n.r,2)+Math.pow(r.g-n.g,2)+Math.pow(r.b-n.b,2)}_findClosestBit(e){const{bit:t}=this.findClosestBitColour(e);return t}}var m=f;t["a"]={log:o,image:d,ColourEncoder:m}},d6cc:function(e,t,n){}});
//# sourceMappingURL=app.5876aaba.js.map